<?xml version="1.0" encoding="utf-8"?>
<modification>
    <id>Kreatiwe Customer Company Name</id>
    <version>1.0</version>
	<vqmver>2.x</vqmver>
    <author>Team Kreatiwe</author>
	<website>https://www.opencart.com/index.php?route=marketplace/extension&amp;filter_member=kreatiwe</website>
	
	<file name="admin/controller/customer/customer.php">
		<operation error="skip">
            <search position="after"><![CDATA[
			$login_info = $this->model_customer_customer->getTotalLoginAttempts($result['email']);
			]]></search>
            <add><![CDATA[
            $companyResults = $this->model_customer_customer->getCustomerCompany($result['customer_id']);
			$companyFinal = $companyResults['company'];
			/* $numItems = count($companyResults);
			$i = 0;
			foreach ($companyResults as $companyResult) {
				if($numItems === 1){
					$companyFinal = $companyResult['company'];
				}
				else{
					if(++$i === $numItems) {
						$companyFinal = $companyFinal . $companyResult['company'];
					}
					else{
						$companyFinal = $companyResult['company'] . ', ';
					}
				}
			} */
			]]></add>
        </operation>
        <operation error="skip">
            <search position="before"><![CDATA[
			'customer_id'    => $result['customer_id'],
			]]></search>
            <add><![CDATA[
            'company'    => $companyFinal,
			]]></add>
        </operation>
		<operation error="skip">
            <search position="before"><![CDATA[
			$data['column_name'] = $this->language->get('column_name');
			]]></search>
            <add><![CDATA[
            $data['column_company'] = $this->language->get('column_company');
			]]></add>
        </operation>
		<operation error="skip">
            <search position="before"><![CDATA[
			$data['sort_name'] = $this->url->link('customer/customer', 'token=' . $this->session->data['token'] . '&sort=name' . $url, true);
			]]></search>
            <add><![CDATA[
            $data['sort_company'] = $this->url->link('customer/customer', 'token=' . $this->session->data['token'] . '&sort=company' . $url, true);
			]]></add>
        </operation>
	</file>
	<file name="admin/language/en-gb/customer/customer.php">
        <operation error="skip">
            <search position="before"><![CDATA[
			$_['column_name']           = 'Customer Name';
			]]></search>
            <add><![CDATA[
            $_['column_company']           = 'Company';
			]]></add>
        </operation>
	</file>
	<file name="admin/model/customer/customer.php">
        <operation error="skip">
            <search position="before"><![CDATA[
			public function getCustomer($customer_id) {
			]]></search>
            <add><![CDATA[
            public function getCustomerCompany($customer_id) {
				$query = $this->db->query("SELECT address.company FROM " . DB_PREFIX . "customer as customer INNER JOIN " . DB_PREFIX . "address as address ON customer.customer_id = address.customer_id WHERE customer.customer_id = '" . (int)$customer_id . "'");

				return $query->row;
			}
			]]></add>
        </operation>
	</file>
	<file name="admin/view/template/customer/customer_list.tpl">
		<operation error="skip">
            <search position="before"><![CDATA[
			<td class="text-left"><?php if ($sort == 'name') { ?>
			]]></search>
            <add><![CDATA[
            <!-- <td class="text-left"><?php echo $column_company; ?></td> -->
			<td class="text-left"><?php if ($sort == 'company') { ?>
				<a href="<?php echo $sort_company; ?>" class="<?php echo strtolower($order); ?>"><?php echo $column_company; ?></a>
				<?php } else { ?>
				<a href="<?php echo $sort_company; ?>"><?php echo $column_company; ?></a>
			<?php } ?></td>
			]]></add>
        </operation>
        <operation error="skip">
            <search position="before"><![CDATA[
			<td class="text-left"><?php echo $customer['name']; ?></td>
			]]></search>
            <add><![CDATA[
            <td class="text-left"><?php echo $customer['company']; ?>
			</td>
			]]></add>
        </operation>
		<operation error="skip">
            <search position="replace" offset="9"><![CDATA[
			<td class="text-left"><?php if ($sort == 'c.ip') { ?>
			]]></search>
            <add><![CDATA[
            
			]]></add>
        </operation>
		<operation error="skip">
            <search position="replace" offset="1"><![CDATA[
			<td class="text-left"><?php echo $customer['ip']; ?></td>
			]]></search>
            <add><![CDATA[
            
			]]></add>
        </operation>
		<operation error="skip">
            <search position="replace" offset="1"><![CDATA[
			<label class="control-label" for="input-ip"><?php echo $entry_ip; ?></label>
			]]></search>
            <add><![CDATA[
            
			]]></add>
        </operation>
		<operation error="skip">
            <search position="replace" offset="5"><![CDATA[
			<label class="control-label" for="input-date-added"><?php echo $entry_date_added; ?></label>
			]]></search>
            <add><![CDATA[
            
			]]></add>
        </operation>
		<!-- <operation error="skip">
            <search position="replace" offset="3" index="7"><![CDATA[
			<div class="form-group">
			]]></search>
            <add><![CDATA[
            
			]]></add>
        </operation>
		<operation error="skip">
            <search position="replace" offset="7" index="7"><![CDATA[
			<div class="form-group">
			]]></search>
            <add><![CDATA[
            
			]]></add>
        </operation> -->
	</file>
	
</modification>